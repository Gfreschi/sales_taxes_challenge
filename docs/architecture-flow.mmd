%%{init: {
  "theme": "base",
  "flowchart": { "curve": "basis", "htmlLabels": true, "padding": 16, "wrap": true },
  "themeVariables": {
    "fontFamily": "Inter, Segoe UI, Roboto, Arial, sans-serif",
    "primaryTextColor": "#0b1220",
    "nodeTextColor": "#0b1220",
    "lineColor": "#64748b",
    "edgeLabelBackground": "#ffffff",
    "fontSize": "14px",
    "graphPadding": 16,
    "nodeSpacing": 28,
    "rankSpacing": 48
  }
}}%%
flowchart 
  subgraph S1["I/O & Parsing"]
    direction LR
    Input[📄 Input<br/>File/STDIN] --> Parser[📝 InputParser<br/>Parse format]
  end

  subgraph S2["Classification & Decisions"]
    direction LR
    Parser --> Classifier[🔍 ProductClassifier<br/>Detect categories]
    Classifier --> Exempt{📚 Tax Exempt?<br/>book/food/medical}
    Classifier --> Import{🌍 Imported?<br/>contains imported}
  end

  subgraph S3["Tax Rules & Calculation"]
    direction LR
    Exempt -->|Yes| NoTax[✅ 0% Tax]
    Exempt -->|No| BasicTax[💰 10% Basic Tax]

    Import -->|Yes| ImportTax[🚢 5% Import Duty]
    Import -->|No| Calculator[🧮 TaxCalculator]

    NoTax --> Calculator
    BasicTax --> Calculator
    ImportTax --> Calculator
  end

  subgraph S4["Currency & Rounding Strategies"]
    direction LR
    Calculator --> Currency[💵 Currency<br/>BigDecimal]
    Currency --> Round[🔄 Round Up<br/>ceil to $0.05]
  end

  subgraph S5["Aggregation"]
    direction LR
    Round --> LineItem[📋 LineItem]
    LineItem --> Receipt[🧾 Receipt<br/>Sales Taxes + Total]
  end

  subgraph S6["Output"]
    direction LR
    Receipt --> Output[🖨️ Final Receipt]
  end

  classDef inputStyle fill:#e1f5fe,stroke:#01579b,stroke-width:2px,rx:10,ry:10
  classDef processStyle fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px,rx:10,ry:10
  classDef decisionStyle fill:#fff9c4,stroke:#f9a825,stroke-width:3px,rx:10,ry:10
  classDef outputStyle fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,rx:10,ry:10

  linkStyle default stroke:#64748b,stroke-width:1.6

  class Input inputStyle
  class Output outputStyle
  class Parser,Classifier,Calculator,Currency,Round,LineItem,Receipt processStyle
  class Exempt,Import decisionStyle
