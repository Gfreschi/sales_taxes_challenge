flowchart TD
    %% Input Layer
    subgraph Input ["ğŸ”µ Input Layer"]
        FileInput["ğŸ“„ File Input<br/>test_data/*.txt"]
        StdinInput["âŒ¨ï¸ STDIN Input<br/>Interactive"]
        CLI["ğŸ–¥ï¸ CLI Interface<br/>exe/sales_tax_calculator"]
    end

    %% Application Layer
    subgraph Application ["ğŸŸ¢ Application Layer"]
        Parser["ğŸ“ InputParser<br/>Regex: quantity + description + price"]
        Generator["ğŸ­ ReceiptGenerator<br/>Orchestrates workflow"]
    end

    %% Business Logic Layer
    subgraph Business ["ğŸŸ¡ Business Logic Layer"]
        Classifier["ğŸ” ProductClassifier<br/>Tax Exemption Detection"]
        Calculator["ğŸ§® TaxCalculator<br/>Rate Application"]

        %% Decision Points
        ExemptCheck{"ğŸ“š Exempt?<br/>book/food/medical"}
        ImportCheck{"ğŸŒ Imported?<br/>contains 'imported'"}

        %% Tax Rates
        BasicTax["ğŸ’° Basic Tax<br/>10% rate"]
        ImportTax["ğŸš¢ Import Duty<br/>5% rate"]
        NoTax["âœ… Tax Exempt<br/>0% rate"]
    end

    %% Domain Layer
    subgraph Domain ["ğŸ”´ Domain Layer"]
        Product["ğŸ“¦ Product<br/>Value Object<br/>Immutable"]
        Currency["ğŸ’µ Currency<br/>BigDecimal precision"]
        Rounding["ğŸ”„ Round Up<br/>ceil to $0.05"]
        LineItem["ğŸ“‹ LineItem<br/>product + tax + final price"]
        Receipt["ğŸ§¾ Receipt<br/>Aggregate totals"]
    end

    %% Output Layer
    subgraph Output ["ğŸŸ£ Output Layer"]
        Formatter["ğŸ“„ Receipt Formatter<br/>Text output"]
        PrintOut["ğŸ–¨ï¸ Final Receipt<br/>Sales Taxes + Total"]
    end

    %% Error Handling
    subgraph Errors ["ğŸ”´ Error Handling"]
        ParseError["âŒ InputParseError<br/>Invalid format"]
        ValidationError["âŒ ValidationError<br/>Negative values"]
    end

    %% Main Flow
    FileInput --> CLI
    StdinInput --> CLI
    CLI --> Parser

    Parser --> Generator
    Parser -.-> ParseError

    Generator --> Product
    Product -.-> ValidationError
    Product --> Classifier

    Classifier --> ExemptCheck
    ExemptCheck -->|Yes| NoTax
    ExemptCheck -->|No| BasicTax

    Classifier --> ImportCheck
    ImportCheck -->|Yes| ImportTax
    ImportCheck -->|No| Calculator

    BasicTax --> Calculator
    ImportTax --> Calculator
    NoTax --> Calculator

    Calculator --> Currency
    Currency --> Rounding
    Rounding --> LineItem

    LineItem --> Receipt
    Receipt --> Formatter
    Formatter --> PrintOut

    %% Styling
    classDef inputStyle fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef appStyle fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef businessStyle fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef domainStyle fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef outputStyle fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef errorStyle fill:#ffebee,stroke:#d32f2f,stroke-width:2px
    classDef decisionStyle fill:#fff9c4,stroke:#f9a825,stroke-width:3px

    class FileInput,StdinInput,CLI inputStyle
    class Parser,Generator appStyle
    class Classifier,Calculator,BasicTax,ImportTax,NoTax businessStyle
    class Product,Currency,Rounding,LineItem,Receipt domainStyle
    class Formatter,PrintOut outputStyle
    class ParseError,ValidationError errorStyle
    class ExemptCheck,ImportCheck decisionStyle